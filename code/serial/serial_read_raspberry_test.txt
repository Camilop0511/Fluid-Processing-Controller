$serialPort = fopen('/dev/ttyS0', 'r');
system('stty -F /dev/ttyS0 57600');

$a3_received = false;
$b4_received = false;
$c5_received = false;

while (true) {
    $byte = fread($serialPort, 1);

    switch ($byte) {
        case "\xa3":
            $a3_received = true;
            $b4_received = false;
            $c5_received = false;
            break;
        case "\xb4":
            $a3_received = false;
            $b4_received = true;
            $c5_received = false;
            break;
        case "\xc5":
            $a3_received = false;
            $b4_received = false;
            $c5_received = true;
            break;
        default:
            if ($a3_received) {
                echo "Step: " . ord($byte) . "\n";
                $a3_received = false;
            } elseif ($b4_received) {
                echo "Temperature: " . ord($byte) . "\n";
                $b4_received = false;
            } elseif ($c5_received) {
                $level_pt = ord($byte);
                $real_volume = ($level_pt * 6.24824) - 9.16149;
                echo "Real Volume: " . $real_volume . "\n";
                $c5_received = false;
            }
            break;
    }
}

fclose($serialPort);